{% extends "fefu_lab/base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block heading %}{{ title }}{% endblock %}

{% block content %}
<div class="container">
    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div class="dashboard-header">
        <div class="welcome-section">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ student.first_name }}!</h2>
            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –æ–±—É—á–µ–Ω–∏–µ–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-content">
                    <h3>{{ enrollments.count }}</h3>
                    <p>–í—Å–µ–≥–æ –∫—É—Ä—Å–æ–≤</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-content">
                    <h3>{{ active_courses }}</h3>
                    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <h3>{{ completed_courses }}</h3>
                    <p>–ó–∞–≤–µ—Ä—à–µ–Ω–æ –∫—É—Ä—Å–æ–≤</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-content">
                    <h3>{{ student.get_faculty_display_name }}</h3>
                    <p>–í–∞—à —Ñ–∞–∫—É–ª—å—Ç–µ—Ç</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø -->
    <div class="quick-actions-section">
        <h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        <div class="quick-actions-grid">
            <a href="{% url 'course_list' %}" class="quick-action-card">
                <div class="action-icon">üîç</div>
                <div class="action-content">
                    <h4>–ù–∞–π—Ç–∏ –∫—É—Ä—Å—ã</h4>
                    <p>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</p>
                </div>
            </a>
            <a href="{% url 'profile' %}" class="quick-action-card">
                <div class="action-icon">üë§</div>
                <div class="action-content">
                    <h4>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h4>
                    <p>–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                </div>
            </a>
            <a href="{% url 'student_list' %}" class="quick-action-card">
                <div class="action-icon">üë•</div>
                <div class="action-content">
                    <h4>–°–æ–∫—É—Ä—Å–Ω–∏–∫–∏</h4>
                    <p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤–∞—à–µ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞</p>
                </div>
            </a>
            <a href="{% url 'feedback' %}" class="quick-action-card">
                <div class="action-icon">üí¨</div>
                <div class="action-content">
                    <h4>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h4>
                    <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º –º–Ω–µ–Ω–∏–µ–º –æ —Å–∏—Å—Ç–µ–º–µ</p>
                </div>
            </a>
        </div>
    </div>

    <!-- –ú–û–ò –ö–£–†–°–´ -->
    <div class="courses-section">
        <div class="section-header">
            <h3>–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
            <div class="section-actions">
                <a href="{% url 'course_list' %}" class="btn btn-primary">–ù–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∫—É—Ä—Å—ã</a>
            </div>
        </div>

        {% if enrollments %}
            <div class="courses-tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="all">–í—Å–µ –∫—É—Ä—Å—ã ({{ enrollments.count }})</button>
                    <button class="tab-button" data-tab="active">–ê–∫—Ç–∏–≤–Ω—ã–µ ({{ active_courses }})</button>
                    <button class="tab-button" data-tab="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ ({{ completed_courses }})</button>
                </div>

                <div class="tab-content">
                    <!-- –í–°–ï –ö–£–†–°–´ -->
                    <div class="tab-pane active" id="tab-all">
                        <div class="enrollments-grid">
                            {% for enrollment in enrollments %}
                            <div class="enrollment-card" data-status="{{ enrollment.status }}">
                                <div class="course-header">
                                    <h4>
                                        <a href="{% url 'course_detail' enrollment.course.slug %}">
                                            {{ enrollment.course.title }}
                                        </a>
                                    </h4>
                                    <span class="status-badge badge-{{ enrollment.status|lower }}">
                                        {{ enrollment.get_status_display }}
                                    </span>
                                </div>
                                
                                <div class="course-info">
                                    <p class="course-description">
                                        {{ enrollment.course.description|truncatewords:20 }}
                                    </p>
                                    
                                    <div class="course-meta">
                                        <div class="meta-item">
                                            <strong>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:</strong>
                                            {% if enrollment.course.instructor %}
                                                {{ enrollment.course.instructor.full_name }}
                                            {% else %}
                                                –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
                                            {% endif %}
                                        </div>
                                        <div class="meta-item">
                                            <strong>–£—Ä–æ–≤–µ–Ω—å:</strong> {{ enrollment.course.get_level_display }}
                                        </div>
                                        <div class="meta-item">
                                            <strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ enrollment.course.duration }} —á–∞—Å–æ–≤
                                        </div>
                                        {% if enrollment.grade %}
                                        <div class="meta-item">
                                            <strong>–û—Ü–µ–Ω–∫–∞:</strong> 
                                            <span class="grade-badge">{{ enrollment.grade }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="enrollment-dates">
                                    <small>–ó–∞–ø–∏—Å–∞–Ω: {{ enrollment.enrolled_at|date:"d.m.Y" }}</small>
                                    {% if enrollment.completed_at %}
                                    <small>–ó–∞–≤–µ—Ä—à–µ–Ω: {{ enrollment.completed_at|date:"d.m.Y" }}</small>
                                    {% endif %}
                                </div>

                                <div class="course-progress">
                                    <div class="progress">
                                        <div class="progress-bar" style="width: {% if enrollment.status == 'COMPLETED' %}100%{% else %}60%{% endif %}"></div>
                                    </div>
                                    <span class="progress-text">
                                        {% if enrollment.status == 'COMPLETED' %}
                                            –ö—É—Ä—Å –∑–∞–≤–µ—Ä—à–µ–Ω
                                        {% elif enrollment.status == 'ACTIVE' %}
                                            –í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è
                                        {% else %}
                                            –û–±—É—á–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                                        {% endif %}
                                    </span>
                                </div>

                                <div class="course-actions">
                                    <a href="{% url 'course_detail' enrollment.course.slug %}" class="btn btn-sm">
                                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫—É—Ä—Å—É
                                    </a>
                                    {% if enrollment.status == 'ACTIVE' %}
                                    <button class="btn btn-sm btn-outline" disabled>
                                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- –ê–ö–¢–ò–í–ù–´–ï –ö–£–†–°–´ -->
                    <div class="tab-pane" id="tab-active">
                        <div class="enrollments-grid">
                            {% for enrollment in enrollments %}
                                {% if enrollment.status == 'ACTIVE' %}
                                <div class="enrollment-card">
                                    <!-- –¢–æ—Ç –∂–µ –∫–æ–Ω—Ç–µ–Ω—Ç —á—Ç–æ –∏ –≤—ã—à–µ, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö -->
                                    {% include "fefu_lab/dashboard/partials/enrollment_card.html" with enrollment=enrollment %}
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <!-- –ó–ê–í–ï–†–®–ï–ù–ù–´–ï –ö–£–†–°–´ -->
                    <div class="tab-pane" id="tab-completed">
                        <div class="enrollments-grid">
                            {% for enrollment in enrollments %}
                                {% if enrollment.status == 'COMPLETED' %}
                                <div class="enrollment-card">
                                    <!-- –¢–æ—Ç –∂–µ –∫–æ–Ω—Ç–µ–Ω—Ç —á—Ç–æ –∏ –≤—ã—à–µ, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö -->
                                    {% include "fefu_lab/dashboard/partials/enrollment_card.html" with enrollment=enrollment %}
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫—É—Ä—Å—ã</h4>
                <p>–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ, –≤—ã–±—Ä–∞–≤ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫—É—Ä—Å—ã –∏–∑ –Ω–∞—à–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
                <a href="{% url 'course_list' %}" class="btn btn-primary">–ù–∞–π—Ç–∏ –∫—É—Ä—Å—ã</a>
            </div>
        {% endif %}
    </div>

    <!-- –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò -->
    <div class="recommendations-section">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫—É—Ä—Å—ã</h3>
        <div class="recommendations-grid">
            <!-- –ó–¥–µ—Å—å –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
            <div class="recommendation-card">
                <div class="recommendation-badge">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</div>
                <h4>–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
                <p>–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∫–∞—Ä—å–µ—Ä—ã –≤ IT</p>
                <div class="recommendation-meta">
                    <span>–ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</span>
                    <span>40 —á–∞—Å–æ–≤</span>
                </div>
                <a href="{% url 'course_list' %}?level=BEGINNER" class="btn btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ö–æ–∂–∏–µ</a>
            </div>
            
            <div class="recommendation-card">
                <div class="recommendation-badge">–î–ª—è –≤–∞—à–µ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞</div>
                <h4>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>
                <p>–£–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã —Å–µ—Ç–µ–π</p>
                <div class="recommendation-meta">
                    <span>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</span>
                    <span>60 —á–∞—Å–æ–≤</span>
                </div>
                <a href="{% url 'course_list' %}?level=ADVANCED" class="btn btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ö–æ–∂–∏–µ</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –¢–∞–±—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
        });
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0';
        setTimeout(() => {
            bar.style.width = width;
        }, 100);
    });
});
</script>
{% endblock %}
