{% extends "fefu_lab/base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block heading %}{{ title }}{% endblock %}

{% block content %}
<div class="container">
    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –ò –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div class="dashboard-header">
        <div class="welcome-section">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ instructor.first_name }}!</h2>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–∏–º–∏ —É—á–µ–±–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏ –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</p>
            {% if instructor.specialization %}
            <div class="specialization-badge">
                –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: {{ instructor.specialization }}
            </div>
            {% endif %}
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-content">
                    <h3>{{ total_courses }}</h3>
                    <p>–ú–æ–∏ –∫—É—Ä—Å—ã</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-content">
                    <h3>{{ total_students }}</h3>
                    <p>–í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <h3>{{ completed_courses }}</h3>
                    <p>–ó–∞–≤–µ—Ä—à–µ–Ω–æ –∫—É—Ä—Å–æ–≤</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-content">
                    <h3>{{ average_rating|default:"-" }}</h3>
                    <p>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø -->
    <div class="quick-actions-section">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏</h3>
        <div class="quick-actions-grid">
            <a href="{% url 'course_list' %}" class="quick-action-card">
                <div class="action-icon">‚ûï</div>
                <div class="action-content">
                    <h4>–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</h4>
                    <p>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —É—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤ —Å–∏—Å—Ç–µ–º—É</p>
                </div>
            </a>
            <a href="{% url 'profile' %}" class="quick-action-card">
                <div class="action-icon">üë§</div>
                <div class="action-content">
                    <h4>–ü—Ä–æ—Ñ–∏–ª—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h4>
                    <p>–û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</p>
                </div>
            </a>
            <a href="#" class="quick-action-card">
                <div class="action-icon">üìä</div>
                <div class="action-content">
                    <h4>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h4>
                    <p>–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                </div>
            </a>
            <a href="{% url 'student_list' %}" class="quick-action-card">
                <div class="action-icon">üë®‚Äçüéì</div>
                <div class="action-content">
                    <h4>–í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã</h4>
                    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã</p>
                </div>
            </a>
        </div>
    </div>

    <!-- –ú–û–ò –ö–£–†–°–´ -->
    <div class="courses-section">
        <div class="section-header">
            <h3>–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
            <div class="section-actions">
                <a href="{% url 'course_list' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å</a>
            </div>
        </div>

        {% if course_stats %}
            <div class="courses-grid">
                {% for stats in course_stats %}
                <div class="course-card">
                    <div class="course-header">
                        <h4>
                            <a href="{% url 'course_detail' stats.course.slug %}">
                                {{ stats.course.title }}
                            </a>
                        </h4>
                        <div class="course-status">
                            <span class="status-badge {% if stats.course.is_active %}status-active{% else %}status-inactive{% endif %}">
                                {{ stats.course.is_active|yesno:"–ê–∫—Ç–∏–≤–µ–Ω,–ù–µ–∞–∫—Ç–∏–≤–µ–Ω" }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="course-info">
                        <p class="course-description">
                            {{ stats.course.description|truncatewords:15 }}
                        </p>
                        
                        <div class="course-meta">
                            <div class="meta-item">
                                <strong>–£—Ä–æ–≤–µ–Ω—å:</strong> {{ stats.course.get_level_display }}
                            </div>
                            <div class="meta-item">
                                <strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ stats.course.duration }} —á–∞—Å–æ–≤
                            </div>
                            <div class="meta-item">
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> 
                                {% if stats.course.price > 0 %}
                                    {{ stats.course.price }} —Ä—É–±.
                                {% else %}
                                    –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–£–†–°–ê -->
                    <div class="course-stats">
                        <div class="stats-grid-mini">
                            <div class="stat-mini">
                                <div class="stat-value">{{ stats.student_count }}</div>
                                <div class="stat-label">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                            </div>
                            <div class="stat-mini">
                                <div class="stat-value">{{ stats.available_spots }}</div>
                                <div class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</div>
                            </div>
                            <div class="stat-mini">
                                <div class="stat-value">{{ stats.completion_rate }}</div>
                                <div class="stat-label">–ó–∞–≤–µ—Ä—à–∏–ª–∏</div>
                            </div>
                        </div>
                        
                        <div class="enrollment-progress">
                            <div class="progress">
                                <div class="progress-bar" style="width: {% widthratio stats.student_count stats.course.max_students 100 %}%"></div>
                            </div>
                            <div class="progress-text">
                                –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å: {{ stats.student_count }}/{{ stats.course.max_students }}
                            </div>
                        </div>
                    </div>

                    <div class="course-actions">
                        <a href="{% url 'teacher_course_management' stats.course.slug %}" class="btn btn-primary">
                            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–º
                        </a>
                        <a href="{% url 'course_detail' stats.course.slug %}" class="btn btn-outline">
                            –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </a>
                        <button class="btn btn-outline" onclick="toggleCourseStatus({{ stats.course.id }})">
                            {{ stats.course.is_active|yesno:"–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å,–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å" }}
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</h4>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç—å –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ</p>
                <a href="{% url 'course_list' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
            </div>
        {% endif %}
    </div>

    <!-- –ü–û–°–õ–ï–î–ù–ò–ï –ê–ö–¢–ò–í–ù–û–°–¢–ò -->
    <div class="activities-section">
        <div class="activities-layout">
            <!-- –ù–ï–î–ê–í–ù–ò–ï –ó–ê–ü–ò–°–ò -->
            <div class="recent-enrollments">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å—ã</h3>
                <div class="enrollments-list">
                    {% for enrollment in recent_enrollments %}
                    <div class="enrollment-item">
                        <div class="student-avatar">
                            {% if enrollment.student.user.profile.avatar %}
                                <img src="{{ enrollment.student.user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                            {% else %}
                                <div class="avatar-default-sm">
                                    {{ enrollment.student.first_name|first }}{{ enrollment.student.last_name|first }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="enrollment-info">
                            <div class="student-name">
                                <a href="{% url 'student_profile' enrollment.student.id %}">
                                    {{ enrollment.student.full_name }}
                                </a>
                            </div>
                            <div class="course-name">
                                –∑–∞–ø–∏—Å–∞–ª—Å—è –Ω–∞ 
                                <a href="{% url 'course_detail' enrollment.course.slug %}">
                                    {{ enrollment.course.title }}
                                </a>
                            </div>
                            <div class="enrollment-date">
                                {{ enrollment.enrolled_at|timesince }} –Ω–∞–∑–∞–¥
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <span class="status-badge badge-{{ enrollment.status|lower }}">
                                {{ enrollment.get_status_display }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-list">
                        <p>–ù–µ—Ç recent –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫—É—Ä—Å—ã</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- –ë–õ–ò–ñ–ê–ô–®–ò–ï –î–ï–î–õ–ê–ô–ù–´ -->
            <div class="upcoming-deadlines">
                <h3>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                <div class="deadlines-list">
                    <div class="deadline-item">
                        <div class="deadline-date">
                            <span class="date-day">15</span>
                            <span class="date-month">–î–µ–∫</span>
                        </div>
                        <div class="deadline-info">
                            <div class="deadline-title">–°–¥–∞—á–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ Python</div>
                            <div class="deadline-course">–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                            <div class="deadline-students">12 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                        </div>
                    </div>
                    <div class="deadline-item">
                        <div class="deadline-date">
                            <span class="date-day">20</span>
                            <span class="date-month">–î–µ–∫</span>
                        </div>
                        <div class="deadline-info">
                            <div class="deadline-title">–≠–∫–∑–∞–º–µ–Ω –ø–æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <div class="deadline-course">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
                            <div class="deadline-students">8 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–´–°–¢–†–´–ô –ü–†–û–°–ú–û–¢–† –°–¢–£–î–ï–ù–¢–û–í -->
    <div class="students-overview">
        <div class="section-header">
            <h3>–°—Ç—É–¥–µ–Ω—Ç—ã –Ω–∞ –º–æ–∏—Ö –∫—É—Ä—Å–∞—Ö</h3>
            <a href="{% url 'student_list' %}" class="btn btn-outline">–í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã</a>
        </div>
        
        <div class="students-stats">
            <div class="stats-cards">
                <div class="stat-card-sm">
                    <div class="stat-value">{{ active_students }}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-card-sm">
                    <div class="stat-value">{{ completed_students }}</div>
                    <div class="stat-label">–ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å—ã</div>
                </div>
                <div class="stat-card-sm">
                    <div class="stat-value">{{ average_grade|default:"-" }}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0';
        setTimeout(() => {
            bar.style.width = width;
        }, 100);
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫—É—Ä—Å–∞
    window.toggleCourseStatus = function(courseId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫—É—Ä—Å–∞?')) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
            console.log('Changing status for course:', courseId);
        }
    };

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    function updateStats() {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        console.log('Updating teacher dashboard stats...');
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(updateStats, 30000);
});
</script>
{% endblock %}
