{% extends "fefu_lab/base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}
{% block heading %}–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É—á–µ–±–Ω—É—é —Å–∏—Å—Ç–µ–º—É –î–í–§–£!{% endblock %}

{% block content %}
<div class="container">
    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –î–õ–Ø –ê–í–¢–û–†–ò–ó–û–í–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
    {% if user.is_authenticated %}
    <div class="welcome-card card">
        <div class="welcome-content">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name }}!</h2>
            <p>–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞ –≤ —É—á–µ–±–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –î–í–§–£.</p>
            
            <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–û –†–û–õ–Ø–ú -->
            {% if user.profile.role == 'STUDENT' %}
                <div class="role-badge badge badge-active">–°—Ç—É–¥–µ–Ω—Ç</div>
                <p>–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤–∞—à–∏—Ö –∫—É—Ä—Å–∞—Ö –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!</p>
            {% elif user.profile.role == 'TEACHER' %}
                <div class="role-badge badge badge-completed">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</div>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –∫—É—Ä—Å–∞–º–∏ –∏ –ø–æ–º–æ–≥–∞–π—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –≤ –æ–±—É—á–µ–Ω–∏–∏!</p>
            {% elif user.profile.role == 'ADMIN' %}
                <div class="role-badge badge badge-dropped">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º–æ–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –µ—ë —Ä–∞–±–æ—Ç—É!</p>
            {% endif %}
        </div>
        <div class="welcome-actions">
            <a href="{% url 'dashboard' %}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
        </div>
    </div>
    {% else %}
    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –î–õ–Ø –ù–û–í–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
    <div class="welcome-card card">
        <div class="welcome-content">
            <h2>–ù–∞—á–Ω–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è!</h2>
            <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –î–í–§–£.</p>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –º–∏—Ä –∑–Ω–∞–Ω–∏–π —Å –Ω–∞—à–µ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.</p>
        </div>
        <div class="welcome-actions">
            <a href="{% url 'register' %}" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            <a href="{% url 'login' %}" class="btn">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
        </div>
    </div>
    {% endif %}

    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´ -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>{{ total_students }}+</h3>
            <p>–°—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_courses }}+</h3>
            <p>–ö—É—Ä—Å–æ–≤</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_instructors }}+</h3>
            <p>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_enrollments }}+</h3>
            <p>–ó–∞–ø–∏—Å–µ–π –Ω–∞ –∫—É—Ä—Å—ã</p>
        </div>
    </div>

    <!-- –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ê–í–¢–û–†–ò–ó–û–í–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
    {% if user.is_authenticated %}
        {% if user.profile.role == 'STUDENT' and user_courses %}
        <div class="section">
            <h2>–í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã</h2>
            <div class="courses-grid">
                {% for enrollment in user_courses %}
                <div class="card course-card">
                    <h3><a href="{% url 'course_detail' enrollment.course.slug %}">{{ enrollment.course.title }}</a></h3>
                    <p>{{ enrollment.course.description|truncatewords:20 }}</p>
                    <div class="course-meta">
                        <span class="badge badge-{{ enrollment.status|lower }}">{{ enrollment.get_status_display }}</span>
                        <span>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {{ enrollment.course.instructor.full_name|default:"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω" }}</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: {% if enrollment.status == 'COMPLETED' %}100%{% else %}50%{% endif %}"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="text-center">
                <a href="{% url 'student_dashboard' %}" class="btn">–í—Å–µ –º–æ–∏ –∫—É—Ä—Å—ã</a>
            </div>
        </div>
        {% elif user.profile.role == 'TEACHER' and user.profile.instructor.courses.exists %}
        <div class="section">
            <h2>–í–∞—à–∏ –∫—É—Ä—Å—ã</h2>
            <div class="courses-grid">
                {% for course in user.profile.instructor.courses.all|slice:":3" %}
                <div class="card course-card">
                    <h3><a href="{% url 'course_detail' course.slug %}">{{ course.title }}</a></h3>
                    <p>{{ course.description|truncatewords:20 }}</p>
                    <div class="course-meta">
                        <span class="badge badge-active">{{ course.enrolled_students_count }} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                        <span>{{ course.get_level_display }}</span>
                    </div>
                    <div class="course-actions">
                        <a href="{% url 'teacher_course_management' course.slug %}" class="btn btn-primary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="text-center">
                <a href="{% url 'teacher_dashboard' %}" class="btn">–í—Å–µ –º–æ–∏ –∫—É—Ä—Å—ã</a>
            </div>
        </div>
        {% endif %}
    {% endif %}

    <!-- –ù–û–í–´–ï –ö–£–†–°–´ (–î–õ–Ø –í–°–ï–•) -->
    {% if recent_courses %}
    <div class="section">
        <h2>–ù–æ–≤—ã–µ –∫—É—Ä—Å—ã</h2>
        <div class="courses-grid">
            {% for course in recent_courses %}
            <div class="card course-card">
                <h3><a href="{% url 'course_detail' course.slug %}">{{ course.title }}</a></h3>
                <p>{{ course.description|truncatewords:30 }}</p>
                <div class="course-meta">
                    <p><strong>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:</strong> 
                        {% if course.instructor %}
                            {{ course.instructor.full_name }}
                        {% else %}
                            –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
                        {% endif %}
                    </p>
                    <p><strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ course.duration }} —á–∞—Å–æ–≤</p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> {{ course.get_level_display }}</p>
                    <p><strong>–°–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç:</strong> {{ course.available_spots }} –∏–∑ {{ course.max_students }}</p>
                </div>
                {% if user.is_authenticated and user.profile.role == 'STUDENT' %}
                <div class="course-actions">
                    <a href="{% url 'course_detail' course.slug %}" class="btn btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    {% if course.available_spots > 0 %}
                    <a href="{% url 'enroll_in_course' course.slug %}" class="btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
                    {% else %}
                    <span class="btn disabled">–ú–µ—Å—Ç –Ω–µ—Ç</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        <div class="text-center">
            <a href="{% url 'course_list' %}" class="btn">–í—Å–µ –∫—É—Ä—Å—ã</a>
        </div>
    </div>
    {% endif %}

    <!-- –ü–û–°–õ–ï–î–ù–ò–ï –°–¢–£–î–ï–ù–¢–´ -->
    <div class="section">
        <h2>–ù–∞—à–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã</h2>
        <div class="students-grid">
            {% for student in students %}
            <div class="card student-card">
                <div class="student-header">
                    <h3><a href="{% url 'student_profile' student.pk %}">{{ student.full_name }}</a></h3>
                    {% if student.user.profile.avatar %}
                    <img src="{{ student.user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="student-avatar">
                    {% endif %}
                </div>
                <div class="student-info">
                    <p><strong>–§–∞–∫—É–ª—å—Ç–µ—Ç:</strong> {{ student.get_faculty_display_name }}</p>
                    <p><strong>Email:</strong> {{ student.email }}</p>
                    {% if student.birth_date %}
                    <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> {{ student.get_age }} –ª–µ—Ç</p>
                    {% endif %}
                </div>
                {% if user.is_authenticated and user.profile.role in 'TEACHER,ADMIN' %}
                <div class="student-actions">
                    <a href="{% url 'student_profile' student.pk %}" class="btn">–ü—Ä–æ—Ñ–∏–ª—å</a>
                </div>
                {% endif %}
            </div>
            {% empty %}
            <div class="alert alert-info">
                –°—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
            </div>
            {% endfor %}
        </div>
        <div class="text-center">
            <a href="{% url 'student_list' %}" class="btn">–í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã</a>
        </div>
    </div>

    <!-- –ë–´–°–¢–†–´–ï –°–°–´–õ–ö–ò –î–õ–Ø –†–ê–ó–ù–´–• –†–û–õ–ï–ô -->
    {% if user.is_authenticated %}
    <div class="section">
        <h2>–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h2>
        <div class="quick-links">
            {% if user.profile.role == 'STUDENT' %}
            <a href="{% url 'course_list' %}" class="quick-link">
                <h3>üìö –í—Å–µ –∫—É—Ä—Å—ã</h3>
                <p>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</p>
            </a>
            <a href="{% url 'student_dashboard' %}" class="quick-link">
                <h3>üéì –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤–∞—à–∏–º–∏ —É—Å–ø–µ—Ö–∞–º–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏</p>
            </a>
            <a href="{% url 'profile' %}" class="quick-link">
                <h3>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <p>–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
            </a>
            {% elif user.profile.role == 'TEACHER' %}
            <a href="{% url 'teacher_dashboard' %}" class="quick-link">
                <h3>üìä –î–∞—à–±–æ—Ä–¥</h3>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ –∫—É—Ä—Å–∞–º–∏ –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</p>
            </a>
            <a href="{% url 'course_list' %}" class="quick-link">
                <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —É—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</p>
            </a>
            <a href="{% url 'profile' %}" class="quick-link">
                <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</p>
            </a>
            {% elif user.profile.role == 'ADMIN' %}
            <a href="{% url 'admin_dashboard' %}" class="quick-link">
                <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–æ–π</p>
            </a>
            <a href="/admin/" class="quick-link">
                <h3>üîß –ê–¥–º–∏–Ω–∫–∞ Django</h3>
                <p>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</p>
            </a>
            <a href="{% url 'student_list' %}" class="quick-link">
                <h3>üë• –°—Ç—É–¥–µ–Ω—Ç—ã</h3>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
